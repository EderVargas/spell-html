let palabras={},palabraActual="",palabrasUsadasPorNivel={};function nuevaPalabraSinRepetir(){actualizarVisibilidadPalabra();let a=document.getElementById("difficulty").value;var e=palabras[a];e&&0!==e.length?(palabrasUsadasPorNivel[a]||(palabrasUsadasPorNivel[a]=[]),0===(e=e.filter(e=>!palabrasUsadasPorNivel[a].includes(e))).length?alert("Ya se usaron todas las palabras para este nivel. Reinicia si deseas comenzar de nuevo."):(palabraActual=e[Math.floor(Math.random()*e.length)],palabrasUsadasPorNivel[a].push(palabraActual),document.getElementById("wordDisplay").textContent=palabraActual,document.getElementById("resultText").textContent="",desHabilitaBotonesSpell(!1),speakWord(palabraActual))):alert("No hay palabras cargadas para este nivel.")}function reiniciarPalabrasUsadas(){document.getElementById("resultText").textContent="";var e=document.getElementById("difficulty").value;palabrasUsadasPorNivel[e]=[]}function iniciarEscucha(){var e;palabraActual?"webkitSpeechRecognition"in window||"SpeechRecognition"in window?((e=new(window.SpeechRecognition||window.webkitSpeechRecognition)).lang="en-US",e.interimResults=!1,e.maxAlternatives=1,document.getElementById("startSpelling").textContent="üé§ Listening...",document.getElementById("resultText").textContent="üî° Spell and say the word (use 'capital', 'double', 'space')...",desHabilitaBotonesSpell(!0),e.onresult=function(e){var e=e.results[0][0].transcript.trim().toLowerCase(),{deletreada:a,finalPalabra:t}=(console.log("Recognized:",e),interpretarSpellingConFinal(e)),n=palabraActual.toLowerCase().replace(/\s+/g,""),e=`<strong>üéß Heard:</strong> ${e}<br>`+`<strong>üß© Spelled:</strong> ${a}<br>`+`<strong>üì£ Said:</strong> ${t}<br>`+(a===n&&t===n?"‚úÖ <strong>Correcto!</strong>":"‚ùå <strong>Incorrecto.</strong>");document.getElementById("resultText").innerHTML=e,document.getElementById("startSpelling").textContent="üé§ Start Spelling",document.getElementById("wordDisplay").classList.remove("hidden"),desHabilitaBotonesSpell(!1)},e.onerror=function(e){console.error("Speech recognition error:",e.error),alert("Ocurri√≥ un error con el reconocimiento de voz. Intenta nuevamente."),desHabilitaBotonesSpell(!(document.getElementById("startSpelling").textContent="üé§ Start Spelling"))},e.start()):alert("Tu navegador no soporta reconocimiento de voz."):alert("Primero genera una palabra para deletrear.")}function interpretarSpellingConFinal(e){var a=e.split(/\s+/);let t="",n=!1,r=!1,l=0;for(;l<a.length;l++){var o=a[l];if("capital"===o)n=!0;else if("space"===o)t+=" ";else if("double"===o)r=!0;else{if(!/^[a-z]$/i.test(o))break;o=n?o.toUpperCase():o.toLowerCase();t+=o,r&&(t+=o,r=!1),n=!1}}e=a.slice(l).join("").toLowerCase();if(""===t&&1<=a.length){var s=a[0].toLowerCase();if(s===a.slice(1).join("").toLowerCase())return{deletreada:s,finalPalabra:s}}return{deletreada:t.toLowerCase(),finalPalabra:e}}function desHabilitaBotonesSpell(e){document.getElementById("startSpelling").disabled=e,document.getElementById("speakAgain").disabled=e,document.getElementById("newWord").disabled=e,document.getElementById("restartWord").disabled=e}function speakWord(e){actualizarVisibilidadPalabra();e=new SpeechSynthesisUtterance(e);e.lang="en-US",e.rate=.9,speechSynthesis.speak(e)}function actualizarVisibilidadPalabra(){var e=document.getElementById("showWordCheckbox");document.getElementById("wordDisplay").classList.toggle("hidden",!e.checked)}fetch("assets/datos.json").then(e=>e.json()).then(e=>{palabras=e}).catch(e=>{console.error("Error al cargar palabras.json:",e),alert("No se pudieron cargar las palabras.")});