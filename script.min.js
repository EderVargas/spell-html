let palabras={},palabraActual="",palabrasUsadasPorNivel={};function nuevaPalabraSinRepetir(){actualizarVisibilidadPalabra();let a=document.getElementById("difficulty").value;var e=palabras[a];e&&0!==e.length?(palabrasUsadasPorNivel[a]||(palabrasUsadasPorNivel[a]=[]),0===(e=e.filter(e=>!palabrasUsadasPorNivel[a].includes(e))).length?alert("Ya se usaron todas las palabras para este nivel. Reinicia si deseas comenzar de nuevo."):(palabraActual=e[Math.floor(Math.random()*e.length)],palabrasUsadasPorNivel[a].push(palabraActual),document.getElementById("wordDisplay").textContent=palabraActual,document.getElementById("resultText").textContent="",desHabilitaBotonesSpell(!1),speakWord(palabraActual))):alert("No hay palabras cargadas para este nivel.")}function reiniciarPalabrasUsadas(){document.getElementById("resultText").textContent="";var e=document.getElementById("difficulty").value;palabrasUsadasPorNivel[e]=[]}function nuevaPalabra(){var e=document.getElementById("difficulty").value,e=palabras[e];e&&0!==e.length?(palabraActual=e[Math.floor(Math.random()*e.length)],document.getElementById("wordDisplay").textContent=palabraActual,document.getElementById("resultText").textContent="",document.getElementById("startSpelling").disabled=!1):alert("No hay palabras cargadas para este nivel.")}function iniciarEscucha(){if(palabraActual)if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){let e=new(window.SpeechRecognition||window.webkitSpeechRecognition),l=(e.lang="en-US",e.interimResults=!1,e.maxAlternatives=1);e.onresult=function(e){var a,t,e=e.results[0][0].transcript.toLowerCase();console.log("Recognized:",e),1===l&&(a=interpretarSpelling(e),console.log("Spelled:",a),palabraActual.toLowerCase().replace(/\s+/g,""),t=a===palabraActual,document.getElementById("resultText").innerHTML=`<strong>üéß Heard:</strong> ${e}<br>`+`<strong>üß© Spelled:</strong> ${a}<br> `+`<strong>${t?"‚úÖ Correct!":"‚ùå Incorrect."}</strong>`,desHabilitaBotonesSpell(!(document.getElementById("startSpelling").textContent="üé§ Start Spelling")),document.getElementById("wordDisplay").classList.remove("hidden"),l=1)},document.getElementById("startSpelling").textContent="Listening...",document.getElementById("resultText").textContent="Spelling (use 'capital' and 'space' if you need)...",desHabilitaBotonesSpell(!0),e.start()}else alert("Tu navegador no soporta reconocimiento de voz.");else alert("Primero genera una palabra para deletrear.")}function desHabilitaBotonesSpell(e){document.getElementById("startSpelling").disabled=e,document.getElementById("speakAgain").disabled=e,document.getElementById("newWord").disabled=e,document.getElementById("restartWord").disabled=e}function interpretarSpelling(e){var a;let t="",l=!1;for(a of e.trim().split(/\s+/))"capital"===a?l=!0:"space"===a?t+=" ":/^[a-z]$/i.test(a)&&(t+=l?a.toUpperCase():a.toLowerCase(),l=!1);return t}function speakWord(e){actualizarVisibilidadPalabra();e=new SpeechSynthesisUtterance(e);e.lang="en-US",e.rate=.9,speechSynthesis.speak(e)}function actualizarVisibilidadPalabra(){var e=document.getElementById("showWordCheckbox");document.getElementById("wordDisplay").classList.toggle("hidden",!e.checked)}fetch("assets/datos.json").then(e=>e.json()).then(e=>{palabras=e}).catch(e=>{console.error("Error al cargar palabras.json:",e),alert("No se pudieron cargar las palabras.")});