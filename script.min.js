let palabras={},palabraActual="",palabrasUsadasPorNivel={};function nuevaPalabraSinRepetir(){let a=document.getElementById("difficulty").value;var e=palabras[a];e&&0!==e.length?(palabrasUsadasPorNivel[a]||(palabrasUsadasPorNivel[a]=[]),0===(e=e.filter(e=>!palabrasUsadasPorNivel[a].includes(e))).length?alert("Ya se usaron todas las palabras para este nivel. Reinicia si deseas comenzar de nuevo."):(palabraActual=e[Math.floor(Math.random()*e.length)],palabrasUsadasPorNivel[a].push(palabraActual),document.getElementById("wordDisplay").textContent=palabraActual,document.getElementById("resultText").textContent="",document.getElementById("startSpelling").disabled=!1,document.getElementById("speakAgain").disabled=!1,speakWord(palabraActual))):alert("No hay palabras cargadas para este nivel.")}function reiniciarPalabrasUsadas(){document.getElementById("resultText").textContent="";var e=document.getElementById("difficulty").value;palabrasUsadasPorNivel[e]=[]}function nuevaPalabra(){var e=document.getElementById("difficulty").value,e=palabras[e];e&&0!==e.length?(palabraActual=e[Math.floor(Math.random()*e.length)],document.getElementById("wordDisplay").textContent=palabraActual,document.getElementById("resultText").textContent="",document.getElementById("startSpelling").disabled=!1):alert("No hay palabras cargadas para este nivel.")}function iniciarEscucha(){if(palabraActual)if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){let e=new(window.SpeechRecognition||window.webkitSpeechRecognition),n=(e.lang="en-US",e.interimResults=!1,e.maxAlternatives=1);e.onresult=function(e){var a,t,e=e.results[0][0].transcript.toLowerCase();console.log("Recognized:",e),1===n&&(a=interpretarSpelling(e),console.log("Spelled:",a),palabraActual.toLowerCase().replace(/\s+/g,""),t=a===palabraActual,document.getElementById("resultText").innerHTML=`<strong>üéß Heard:</strong> ${e}<br>`+`<strong>üß© Spelled:</strong> ${a}<br> `+`<strong>${t?"‚úÖ Correct!":"‚ùå Incorrect."}</strong>`,document.getElementById("startSpelling").textContent="üé§ Start Spelling",n=1)},document.getElementById("startSpelling").textContent="Listening...",document.getElementById("resultText").textContent="Spelling (use 'capital' and 'space' if you need)...",e.start()}else alert("Tu navegador no soporta reconocimiento de voz.");else alert("Primero genera una palabra para deletrear.")}function interpretarSpelling(e){var a;let t="",n=!1;for(a of e.trim().split(/\s+/))"capital"===a?n=!0:"space"===a?t+=" ":/^[a-z]$/i.test(a)&&(t+=n?a.toUpperCase():a.toLowerCase(),n=!1);return t}function speakWord(e){e=new SpeechSynthesisUtterance(e);e.lang="en-US",e.rate=.9,speechSynthesis.speak(e)}fetch("assets/datos.json").then(e=>e.json()).then(e=>{palabras=e}).catch(e=>{console.error("Error al cargar palabras.json:",e),alert("No se pudieron cargar las palabras.")});